---
title: "Exposer mes services Docker avec Traefik sur mon NAS : Ubiquiti, DNS et fallback Tailscale"
publishedAt: "2025-05-12"
summary: "Comment j'ai configuré Traefik sur mon NAS pour exposer mes services Docker, avec fallback Tailscale et gestion DNS externe."
tags:
- Traefik
- Docker
- NAS
- Ubiquiti
- Tailscale
- DNS
shortTitle: Traefik NAS
---

## Pourquoi ai-je démarré ce projet ?

En auto-hébergeant plusieurs services Docker sur mon NAS, je voulais pouvoir les rendre accessibles depuis l’extérieur de manière :

* Sécurisée (HTTPS),
* Flexible (nom de domaine personnalisé),
* Sans contrainte pour mes utilisateurs (ma famille notamment).

Je cherchais aussi une solution **complémentaire à Tailscale** :

* Certains utilisateurs de mon entourage n’ont pas la capacité ou l’envie d’installer Tailscale sur leur machine.
* Certains devices (Smart TV, objets connectés, ...) ne sont pas compatibles avec Tailscale.
* En fallback, je continue de passer par Tailscale pour mes propres accès admin et services non exposés.

D’où l’idée de mettre en place un **reverse proxy public (Traefik)** en complément du réseau privé (Tailscale).

## Stack réseau

Voici l’architecture :

* **NAS** : héberge mes containers Docker,
* **Docker Compose** : pour orchestrer les stacks,
* **Traefik v2.11** : reverse proxy dynamique + SSL automatique,
* **Ubiquiti Gateway** : en charge du routage, firewall, NAT,
* **Vercel DNS** : gestion des enregistrements DNS,
* **Tailscale** : accès réseau privé chiffré (fallback / admin).

<Image
width={600}
height={400}
src="/blog/reverse-proxy/network.svg"
/>

### Rôle de la DMZ

* Ma box Internet est passée en **DMZ** vers la **Ubiquiti Gateway**.
* Cela signifie que la box ne fait plus de NAT ou de filtrage → c’est Ubiquiti qui prend le contrôle complet du firewall, du NAT et du port forwarding.
* Avantage : éviter les problèmes de double NAT, améliorer la sécurité, centraliser la configuration.

## Configuration de Traefik

Mon `docker-compose.yml` de base :

```yaml
services:
  traefik:
    image: traefik:v2.11
    container_name: traefik
    restart: unless-stopped
    command:
      - "--api.dashboard=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:8081"
      - "--entrypoints.websecure.address=:8443"
      - "--certificatesresolvers.le.acme.email=${EMAIL}"
      - "--certificatesresolvers.le.acme.storage=/letsencrypt/acme.json"
      - "--certificatesresolvers.le.acme.tlschallenge=true"
      - "--entrypoints.websecure.http.tls.certresolver=le"
      - "--entrypoints.web.http.redirections.entryPoint.to=websecure"
      - "--entrypoints.web.http.redirections.entryPoint.scheme=https"
    ports:
      - "8880:8080"   # Dashboard Traefik
      - "8081:8081"   # HTTP interne Traefik
      - "8443:8443"   # HTTPS interne Traefik
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /volume2/docker/traefik/letsencrypt:/letsencrypt
    networks:
      - proxy
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.api.rule=Host(`traefik.${DOMAIN}`)"
      - "traefik.http.routers.api.entrypoints=websecure"
      - "traefik.http.routers.api.service=api@internal"
      - "traefik.http.routers.api.middlewares=auth-traefik"
      - "traefik.http.middlewares.auth-traefik.basicauth.users=${USER_TRAEFIK}:${HASHED_PASSWORD}"
      - "traefik.docker.network=proxy"
    sysctls:
      - net.ipv6.conf.all.disable_ipv6=1
      - net.ipv6.conf.default.disable_ipv6=1
networks:
  proxy:
    external: true
```

## Exposition des services

Pour chaque service Docker, j’ajoute des labels Traefik :

```yaml
labels:
  - "traefik.enable=true"
  - "traefik.http.routers.monservice.rule=Host(`monservice.${DOMAIN}`)"
  - "traefik.http.routers.monservice.entrypoints=websecure"
```

Ce qui permet d’accéder au service via :

```text
https://monservice.mondomaine.fr
```

## Configuration DNS

Chez **Vercel**, j’ai configuré les enregistrements DNS correspondants :

```text
A  monservice.mondomaine.com   <IP_PUBLIC>
```

Ainsi, le flux réseau est :

```text
Client externe ➞ DNS Vercel ➞ IP publique ➞ Ubiquiti Gateway ➞ NAS ➞ Traefik ➞ Service Docker
```

## Pourquoi Traefik + Tailscale ?

### Cas utilisateur

**Sans Traefik** : j’étais obligé de demander à ma famille d’installer Tailscale, ce qui :

* N’était pas adapté sur certains terminaux (Smartphone, TV...),
* Pouvait être une friction pour les moins techniques.

**Avec Traefik** :

* Je peux exposer **certains services** (ex: dashboard photo, serveur multimédia) en HTTPS public, accessibles par simple URL.
* Je limite les risques avec du **Basic Auth** sur l’accès public.
* Pour mes usages admin (monitoring, services sensibles), je continue de passer **par Tailscale uniquement**.

### En résumé :

```text
Services publics (HTTPS) ➞ Traefik ➞ DNS Vercel ➞ famille / invités
Services privés (LAN / admin) ➞ Tailscale ➞ accès full sécurisé
```

## Conclusion

Avec cette architecture hybride :

* Je sécurise et expose les services grand public,
* Je garde un accès privé et chiffré pour mes besoins pro via Tailscale,
* J’ai une gestion réseau centralisée avec Ubiquiti,
* Je contrôle totalement le routage et les certificats avec Traefik.